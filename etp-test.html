<html>
  <style>
    .tooltip {
    position: relative;
    }

    .tooltip .tooltiptext {
    visibility: hidden;
    width: 300px;
    background-color: black;
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 10px 10px;
    position: absolute;
    z-index: 1;
    top: -5px;
    left: 110%;
    }

    .tooltip .tooltiptext::after {
    content: "";
    position: absolute;
    top: 50%;
    right: 100%;
    margin-top: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: transparent black transparent transparent;
    }
    .tooltip:hover .tooltiptext {
    visibility: visible;
    }
  </style>

  <head>
  </head>
  <body>
    <h1>Tracker Blocking (i.e., resource blocking)</h1>
    <p>Test will say "Blocked" if Firefox is blocking resources from that list.</p>
    <table cellpadding="5" cellspacing="0" border="1">
        <thead>
            <tr>
                <th colspan="2" bgcolor=#0c0c0d style="color: #ffffff"><b>Tracking Protection Check</b></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="2" bgcolor=#cccccc class="tooltip">Social Tracking Protection Lists</th>
                <span class="tooltiptext">STP uses the following lists: (social-tracking-protection-facebook-digest256, social-tracking-protection-linkedin-digest256, social-tracking-protection-twitter-digest256). We have to check each of these individually, but if the feature is working correctly all three should be blocked (or not blocked) depending on which configuration you're testing.</span>
            </tr>
            <tr>
                <td>social-tracking-protection-facebook-digest256:</td>
                <td>
                  <img
                   id="stp-img-facebook-digest256"
                   src="https://social-tracking-protection-facebook-digest256.dummytracker.org/test_not_blocked.png"
                   onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
               </td>
            </tr>
            <tr>
                <td>social-tracking-protection-linkedin-digest256:</td>
                <td>
                  <img
                   id="stp-img-linkedin-digest256"
                   src="https://social-tracking-protection-linkedin-digest256.dummytracker.org/test_not_blocked.png"
                   onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
                </td>
            </tr>
            <tr>
                <td>social-tracking-protection-twitter-digest256:</td>
                <td>
                  <img
                     id="stp-img-twitter-digest256"
                     src="https://social-tracking-protection-twitter-digest256.dummytracker.org/test_not_blocked.png"
                     onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
                </td>
            </tr>
            <tr>
                <td><b>Summary:</b></td>
                <td><img id="stp-img-summary"></td>
            </tr>
            <tr>
                <td colspan="2" bgcolor=#cccccc>Fingerprinting List</td>
            </tr>
            <tr>
                <td>base-fingerprinting-track-digest256:</td>
                <td>
                  <img
                     src="https://base-fingerprinting-track-digest256.dummytracker.org/test_not_blocked.png"
                     onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
               </td>
            </tr>
            <tr>
                <td colspan="2" bgcolor=#cccccc>Cryptomining List</td>
            </tr>
            <tr>
                <td>base-cryptomining-track-digest256:</td>
                <td>
                  <img
                     src="https://base-cryptomining-track-digest256.dummytracker.org/test_not_blocked.png"
                     onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
                </td>
            </tr>
            <tr>
                <td colspan="2" bgcolor=#cccccc>Level 1 (Basic) List Tracker Blocking</th>
            </tr>
            <tr>
                <td>social-track-digest256:</td>
                <td>
                  <img
                    id="lvl-one-img-social-digest256"
                    src="https://social-track-digest256.dummytracker.org/test_not_blocked.png"
                    onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
                </td>
            </tr>
            <tr>
                <td>ads-track-digest256:</td>
                <td>
                  <img
                    id="lvl-one-img-ads-digest256"
                    src="https://ads-track-digest256.dummytracker.org/test_not_blocked.png"
                    onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
                </td>
            </tr>
            <tr>
                <td>analytics-track-digest256:</td>
                <td>
                  <img
                    id="lvl-one-img-analytics-digest256"
                    src="https://analytics-track-digest256.dummytracker.org/test_not_blocked.png"
                    onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
                </td>
            </tr>
            <tr>
                <td><b>Summary:</b></td>
                <td><img id="lvl-one-img-summary"></td>
            </tr>
            <tr>
                <td colspan="2" bgcolor=#cccccc>Level 2 (Strict List) List Tracker Blocking</th>
            </tr>
            <tr>
                <td>content-track-digest256:</td>
                <td>
                  <img
                     src="https://content-track-digest256.dummytracker.org/test_not_blocked.png"
                     onerror="this.onerror=null;this.src='https://not-a-tracker.dummytracker.org/test_blocked.png'">
                </td>
            </tr>
        </tbody>
    </table>

    <h1>Cookie Blocking</h1>
    <b>NOTE: If tracker blocking is enabled for STP domains, these tests will not work properly.</b>
    <iframe height=0 width=0 src="https://social-tracking-protection-facebook-digest256.dummytracker.org/cookie_access_test.html?test_origin=mozilla.github.io"></iframe>
    <iframe height=0 width=0 src="https://social-tracking-protection-linkedin-digest256.dummytracker.org/cookie_access_test.html?test_origin=mozilla.github.io"></iframe>
    <iframe height=0 width=0 src="https://social-tracking-protection-twitter-digest256.dummytracker.org/cookie_access_test.html?test_origin=mozilla.github.io"></iframe>

    <p><h3>Social Tracking Protection Lists</h3>
    * Facebook - `social-tracking-protection-facebook-digest256`: <pre id="social-tracking-protection-facebook-digest256"></pre>
    * LinkedIn - `social-tracking-protection-linkedin-digest256`: <pre id="social-tracking-protection-linkedin-digest256"></pre>
    * Twitter - `social-tracking-protection-twitter-digest256`: <pre id="social-tracking-protection-twitter-digest256"></pre>
    </p>

    <script>
      const STP_IMG_LIST = [
        "stp-img-facebook-digest256",
        "stp-img-linkedin-digest256",
        "stp-img-twitter-digest256"
      ];
      const LEVENL_ONE_LIST = [
        "lvl-one-img-ads-digest256",
        "lvl-one-img-analytics-digest256",
        "lvl-one-img-social-digest256"
      ];

      main();

      function main() {
        window.addEventListener(
          "message",
          event => {
            lists = [
              "social-tracking-protection-facebook-digest256",
              "social-tracking-protection-linkedin-digest256",
              "social-tracking-protection-twitter-digest256"
            ];
            lists.forEach(list => {
              if (event.origin === `https://${list}.dummytracker.org`) {
                updateCookieStatus(event.data, list);
              }
            });
          },
          false
        );

        getSummary(STP_IMG_LIST, "stp-img-summary");
        getSummary(LEVENL_ONE_LIST, "lvl-one-img-summary");
      }

      function getElements(elementIds) {
        let elementsLists = [];
        for (let id of elementIds) {
          element = document.getElementById(id);
          elementsLists.push(element);
        }
        return elementsLists;
      }

      function getSummary(elementIds, summaryId) {
        const isAllBlocked = currentValue =>
          currentValue.src ===
          "https://not-a-tracker.dummytracker.org/test_blocked.png";
        const stpBlocked = getElements(elementIds).every(
          currentValue =>
            currentValue.src ===
            "https://not-a-tracker.dummytracker.org/test_blocked.png"
        );
        const image = document.getElementById(summaryId);
        if (stpBlocked) {
          image.src = "https://not-a-tracker.dummytracker.org/test_blocked.png";
          console.log("STP enabled successfully");
        } else {
          image.src = "https://not-a-tracker.dummytracker.org/test_not_blocked.png";
          console.log("STP not enabled successfully");
        }
      }

      function updateCookieStatus(statusMessage, list) {
          var output = document.getElementById(list);
          if (statusMessage === 'cookies') {
            output.innerHTML = "Cookies not blocked";
          } else if (statusMessage === 'no_cookies') {
            output.innerHTML = "Cookies BLOCKED";
          } else {
            output.innerHTML = "Unrecognized status";
          }
      }
    </script>
  </body>
</html>
